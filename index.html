<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MindAR ‚Äî One Model at a Time (Fixed)</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

  <!-- ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π MindAR —á–µ—Ä–µ–∑ jsDelivr -->
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-family: Arial, sans-serif;
      background: rgba(0,0,0,0.7);
      padding: 12px 24px;
      border-radius: 10px;
      z-index: 999;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</div>

  <a-scene
    mindar-image="imageTargetSrc: target.mind; maxTrack: 1;"
    embedded
    vr-mode-ui="enabled: false"
    renderer="colorManagement: true; physicallyCorrectLights: true;"
    loading-screen="enabled: false"
    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
    id="scene">

    <!-- –ö–∞–º–µ—Ä–∞ –∏ —Å–≤–µ—Ç -->
    <a-entity camera></a-entity>
    <a-entity light="type: ambient; intensity: 1.0"></a-entity>
    <a-entity light="type: directional; intensity: 0.8; color: #FFF" position="1 1 1"></a-entity>

    <!-- –¢—Ä–µ–∫–µ—Ä 1 ‚Üí model1.glb -->
    <a-entity id="target1" mindar-image-target="targetIndex: 0" visible="false">
      <a-entity
        id="model1"
        gltf-model="./models/model1.glb"
        scale="0.5 0.5 0.5"
        position="0 0 0"
        rotation="0 0 0"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear"
        visible="false">
      </a-entity>
    </a-entity>

    <!-- –¢—Ä–µ–∫–µ—Ä 2 ‚Üí model2.glb -->
    <a-entity id="target2" mindar-image-target="targetIndex: 1" visible="false">
      <a-entity
        id="model2"
        gltf-model="./models/model2.glb"
        scale="0.5 0.5 0.5"
        position="0 0 0"
        rotation="0 0 0"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"
        visible="false">
      </a-entity>
    </a-entity>

  </a-scene>

  <script>
    const scene = document.getElementById('scene');
    const loading = document.getElementById('loading');

    const model1 = document.getElementById('model1');
    const model2 = document.getElementById('model2');
    const target1 = document.getElementById('target1');
    const target2 = document.getElementById('target2');

    let modelsLoaded = 0;
    const totalModels = 2;

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π
    function onModelLoaded() {
      modelsLoaded++;
      if (modelsLoaded === totalModels) {
        // –í—Å–µ –º–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã ‚Äî –º–æ–∂–Ω–æ —Å–∫—Ä—ã–≤–∞—Ç—å –ª–æ–∞–¥–µ—Ä –∏ –≤–∫–ª—é—á–∞—Ç—å –ª–æ–≥–∏–∫—É
        setTimeout(() => {
          loading.style.display = 'none';
          enableTrackingLogic();
        }, 500);
      }
    }

    // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π
    model1.addEventListener('model-loaded', onModelLoaded);
    model2.addEventListener('model-loaded', onModelLoaded);

    // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
    function enableTrackingLogic() {
      console.log("‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. AR –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.");

      target1.addEventListener('targetFound', () => {
        target1.setAttribute('visible', 'true');
        model1.setAttribute('visible', 'true');
        target2.setAttribute('visible', 'false');
        model2.setAttribute('visible', 'false');
        console.log("üéØ –ê–∫—Ç–∏–≤–Ω–æ: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 1 ‚Üí model1.glb");
      });

      target1.addEventListener('targetLost', () => {
        target1.setAttribute('visible', 'false');
        model1.setAttribute('visible', 'false');
      });

      target2.addEventListener('targetFound', () => {
        target2.setAttribute('visible', 'true');
        model2.setAttribute('visible', 'true');
        target1.setAttribute('visible', 'false');
        model1.setAttribute('visible', 'false');
        console.log("üéØ –ê–∫—Ç–∏–≤–Ω–æ: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 2 ‚Üí model2.glb");
      });

      target2.addEventListener('targetLost', () => {
        target2.setAttribute('visible', 'false');
        model2.setAttribute('visible', 'false');
      });
    }

    // –ï—Å–ª–∏ –º–æ–¥–µ–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (–∫–µ—à–∏—Ä–æ–≤–∞–Ω—ã), –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É —Å—Ä–∞–∑—É
    if (model1.hasLoaded && model2.hasLoaded) {
      setTimeout(() => {
        loading.style.display = 'none';
        enableTrackingLogic();
      }, 500);
    }
  </script>
</body>
</html>
