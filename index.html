<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>AR.js Multi-Marker App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- –õ–æ–∫–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
  <script src="lib/aframe.min.js"></script>
  <script src="lib/aframe-ar.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #loading {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.7); color: #fff; padding: 12px 20px;
      border-radius: 6px; font-family: sans-serif; z-index: 9999;
    }
    #debug {
      position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.6); color: #0f0; padding: 6px 12px;
      font-family: monospace; border-radius: 4px; font-size: 14px;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  <div id="debug">üö´ –ú–∞—Ä–∫–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω</div>

  <a-scene
    vr-mode-ui="enabled: false"
    renderer="antialias: true; logarithmicDepthBuffer: true"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
  >
    <a-entity camera></a-entity>
    <a-entity id="marker-container"></a-entity>
  </a-scene>

  <script>
    const container = document.getElementById("marker-container");
    const loadingDiv = document.getElementById("loading");
    const debugDiv = document.getElementById("debug");

    fetch("config.json")
      .then(r => r.json())
      .then(config => {
        config.markers.forEach(item => {
          const marker = document.createElement("a-marker");
          marker.setAttribute("type", "pattern");
          marker.setAttribute("url", item.patternUrl);

          // –º–æ–¥–µ–ª—å
          const model = document.createElement("a-entity");
          model.setAttribute("gltf-model", item.model);
          if (item.scale) model.setAttribute("scale", item.scale);
          model.setAttribute("animation", "property: rotation; to: 0 360 0; loop: true; dur: 6000; easing: linear");
          marker.appendChild(model);

          // –∑–≤—É–∫ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
          if (item.sound) {
            const soundEl = document.createElement("a-sound");
            soundEl.setAttribute("src", item.sound);
            soundEl.setAttribute("autoplay", false);
            soundEl.setAttribute("positional", false);
            marker.appendChild(soundEl);

            marker.addEventListener("markerFound", () => {
              soundEl.components.sound.playSound();
            });
            marker.addEventListener("markerLost", () => {
              soundEl.components.sound.stopSound();
            });
          }

          // üîç DEBUG: —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
          marker.addEventListener("markerFound", () => {
            debugDiv.textContent = "‚úÖ –ù–∞–π–¥–µ–Ω –º–∞—Ä–∫–µ—Ä: " + (item.patternUrl || item.model);
            debugDiv.style.color = "#0f0";
          });
          marker.addEventListener("markerLost", () => {
            debugDiv.textContent = "üö´ –ú–∞—Ä–∫–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω";
            debugDiv.style.color = "#f44";
          });

          container.appendChild(marker);
        });

        loadingDiv.style.display = "none";
      })
      .catch(err => {
        console.warn("–û—à–∏–±–∫–∞ config.json:", err);
        loadingDiv.textContent = "‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏";
      });
  </script>
</body>
</html>
